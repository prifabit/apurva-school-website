---
import { getLangFromUrl, useTranslations } from '../i18n/utils';
import ThemeToggle from './ThemeToggle.astro';
import LanguageToggle from './LanguageToggle.astro';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const navItems = [
  { href: 'nav.home', label: 'nav.home', path: '' },
  { href: 'nav.about', label: 'nav.about', path: 'about' },
  { href: 'nav.facilities', label: 'nav.facilities', path: 'facilities' },
  { href: 'nav.admission', label: 'nav.admission', path: 'admission' },
  { href: 'nav.committee', label: 'nav.committee', path: 'committee' },
  { href: 'nav.gallery', label: 'nav.gallery', path: 'gallery' },
  { href: 'nav.downloads', label: 'nav.downloads', path: 'downloads' },
  { href: 'nav.contact', label: 'nav.contact', path: 'contact' },
];

const homePath = lang === 'en' ? '/en/' : '/';
---

<header class="sticky top-0 z-50 w-full glass transition-colors duration-400">
  <div class="container mx-auto px-4 lg:px-8 h-20 flex items-center justify-between">
    <a href={homePath} class="flex items-center gap-3 hover:opacity-80 transition-opacity duration-300">
      <div class="w-12 h-12 bg-gradient-to-br from-[var(--primary)] to-[var(--primary-hover)] rounded-xl flex items-center justify-center shadow-soft">
        <span class="text-white text-xl font-bold pt-1">A</span>
      </div>
      <div class="flex flex-col justify-center">
        <span class="text-lg sm:text-xl font-bold text-[var(--foreground)] tracking-tight leading-tight">
          {lang === 'en' ? 'Apurva Residential School for Mentally Challenged' : 'अपूर्वा निवासी मतीमंद विद्यालय'}
        </span>
      </div>
    </a>

    <!-- Desktop Nav -->
    <nav class="hidden lg:flex items-center gap-2">
      {navItems.map((item) => (
        <a 
          href={lang === 'en' ? `/en/${item.path === 'home' ? '' : item.path}` : `/${item.path === 'home' ? '' : item.path}`} 
          class="relative px-3 py-2 text-sm font-medium text-[var(--foreground)] opacity-70 hover:opacity-100 transition-all duration-300 group"
        >
          {t(item.label as any)}
          <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-[var(--primary)] transition-all duration-300 group-hover:w-full opacity-50"></span>
        </a>
      ))}
    </nav>

    <div class="flex items-center gap-3">
      <div class="hidden sm:block">
        <LanguageToggle />
      </div>
      <ThemeToggle />
      
      <!-- Mobile Menu Button -->
      <button 
        id="mobile-menu-toggle"
        class="lg:hidden p-2.5 rounded-xl bg-[var(--background)] text-[var(--foreground)] hover:opacity-80 transition-opacity duration-300"
        aria-label="Open Menu"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div 
    id="mobile-menu" 
    class="hidden lg:hidden border-t bg-[var(--card-bg)] px-4 py-6"
  >
    <nav class="flex flex-col gap-3">
      {navItems.map((item) => (
        <a 
          href={lang === 'en' ? `/en/${item.path === 'home' ? '' : item.path}` : `/${item.path === 'home' ? '' : item.path}`} 
          class="text-base font-semibold text-[var(--foreground)] py-2"
        >
          {t(item.label as any)}
        </a>
      ))}
    </nav>
  </div>
</header>

<script>
  const toggle = document.getElementById('mobile-menu-toggle');
  const menu = document.getElementById('mobile-menu');

  toggle?.addEventListener('click', () => {
    menu?.classList.toggle('hidden');
  });
</script>
